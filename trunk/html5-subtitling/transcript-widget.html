<html>
<head>
<link href="transcript-widget.css" type="text/css" rel="stylesheet"/>
<script>
var current_line = null;
var f = null;

function add_line(){
  if (current_line)
    current_line.style.background = "#ffd";

  line = document.createElement("input");
  line.setAttribute("type", "text");
  line.setAttribute("class", "inputline");
  f.appendChild(line);
  f.appendChild(document.createElement("br"));
  line.focus();
  return line;
}

var MAXCHARS = 60;
function load(event){
  f = document.getElementById("inputfields");
  out = document.getElementById("output");

  current_line = add_line();

  function hex(i){
    i = Math.floor(i);
    var code = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F'];
    return code[i];
  }

  function color_scale(i){
    var first_chars = 40;
    if (i<first_chars) i=0
    else i-=first_chars;

    r=15;
    g = 16 - 16*i/(MAXCHARS-first_chars);
    b = 12 - 12*i/(MAXCHARS-first_chars);
    return "#" + hex(r) + hex(g) + hex(b);
  }

  function KeyHandler(e){
    current_line.style.background=color_scale(current_line.value.length);

    if (current_line.value.length > MAXCHARS){
      current_line = add_line();
    }
//    out.innerHTML += e.type + " ";
  }

  window.addEventListener("keydown", KeyHandler, true);
  window.addEventListener("keyup", KeyHandler, true);
  window.addEventListener("keypress", KeyHandler, true);
}
</script>
</head>
<body onload="load(event);">
<div id="output"></div>
<div class="transcript_widget" id="inputfields"></div>
</body>
</html>
